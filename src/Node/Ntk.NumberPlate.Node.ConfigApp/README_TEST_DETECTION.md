# راهنمای استفاده از بخش تست تشخیص پلاک

## معرفی

بخش تست تشخیص پلاک به شما امکان می‌دهد قبل از راه‌اندازی سرویس اصلی، عملکرد مدل YOLO و تنظیمات تشخیص را روی تصاویر آزمایشی بررسی کنید.

---

## 📥 دریافت مدل YOLO

برای استفاده از سیستم تشخیص، به یک مدل YOLO آموزش‌دیده نیاز دارید. چند گزینه دارید:

### گزینه 1: استفاده از مدل‌های آموزش‌دیده موجود

**منابع پیشنهادی:**

1. **Roboflow Universe**

   - وبسایت: https://universe.roboflow.com/
   - جستجو: "iranian license plate" یا "persian license plate"
   - دانلود مدل در فرمت ONNX

2. **GitHub**

   - جستجو: `iranian license plate yolo onnx`
   - پروژه‌های تحقیقاتی دانشگاهی

3. **Hugging Face**
   - وبسایت: https://huggingface.co/models
   - جستجو: "license plate detection"

### گزینه 2: آموزش مدل شخصی (توصیه می‌شود)

برای بهترین نتایج، مدل خود را آموزش دهید:

#### 1️⃣ آماده‌سازی دیتاست

```bash
# نصب ابزارهای لازم
pip install ultralytics
pip install labelimg
```

**جمع‌آوری داده:**

- حداقل 500-1000 عکس از پلاک‌های ایرانی
- عکس‌ها در شرایط مختلف (روز/شب، زاویه‌های مختلف)
- کیفیت متنوع

**برچسب‌گذاری:**

- استفاده از LabelImg یا Roboflow
- مشخص کردن Bounding Box پلاک‌ها
- ذخیره در فرمت YOLO

#### 2️⃣ آموزش مدل

```bash
# نصب Ultralytics
pip install ultralytics

# آموزش مدل YOLOv8
yolo detect train \
  data=path/to/data.yaml \
  model=yolov8n.pt \
  epochs=100 \
  imgsz=640 \
  batch=16
```

**محتوای فایل `data.yaml`:**

```yaml
train: path/to/train/images
val: path/to/val/images

nc: 1 # تعداد کلاس‌ها (فقط پلاک)
names: ["license_plate"]
```

#### 3️⃣ Export به ONNX

```bash
# تبدیل مدل به ONNX
yolo export model=runs/detect/train/weights/best.pt format=onnx
```

فایل `best.onnx` حاصل همان مدلی است که در ConfigApp استفاده می‌شود.

### گزینه 3: استفاده از مدل عمومی (برای تست)

برای شروع و تست برنامه:

```bash
# دانلود YOLOv8n
wget https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8n.pt

# تبدیل به ONNX
yolo export model=yolov8n.pt format=onnx
```

⚠️ **هشدار:** مدل‌های عمومی برای پلاک ایرانی آموزش ندیده‌اند و ممکن است نتیجه خوبی ندهند.

### گزینه 4: خرید مدل آموزش‌دیده

اگر زمان برای آموزش ندارید:

- شرکت‌های ارائه‌دهنده خدمات Computer Vision
- پلتفرم‌های فریلنسری (جستجو برای متخصصین YOLO)

### توصیه‌ها برای مدل بهتر

1. **تنوع دیتاست:**

   - پلاک‌های جدید و قدیمی
   - شرایط نوری مختلف
   - فاصله‌های متفاوت از دوربین

2. **Data Augmentation:**

   - چرخش، کج کردن
   - تغییر روشنایی و کنتراست
   - افزودن نویز

3. **تنظیمات آموزش:**

   - Epochs: 100-300
   - Batch size: 16-32
   - Image size: 640x640
   - Learning rate: 0.001 (پیش‌فرض)

4. **ارزیابی:**
   - Precision بالای 90%
   - Recall بالای 85%
   - mAP بالای 0.85

---

## نحوه استفاده

### 1. راه‌اندازی اولیه

قبل از استفاده از بخش تست، مطمئن شوید که:

- مسیر مدل YOLO را در تنظیمات برنامه ConfigApp وارد کرده‌اید
- فایل مدل YOLO (`.onnx`) در مسیر مشخص شده موجود است
- آستانه اعتماد (Confidence Threshold) را به مقدار مناسب تنظیم کرده‌اید (معمولاً بین 0.3 تا 0.7)

### 2. باز کردن فرم تست

1. برنامه `Ntk.NumberPlate.Node.ConfigApp.exe` را اجرا کنید
2. روی دکمه **"تست تشخیص پلاک"** (بنفش رنگ) کلیک کنید
3. فرم تست تشخیص باز خواهد شد

### 3. تست تشخیص پلاک

1. **بارگذاری تصویر:**

   - روی دکمه **"بارگذاری تصویر"** کلیک کنید
   - یک تصویر حاوی پلاک خودرو را انتخاب کنید
   - فرمت‌های پشتیبانی شده: JPG, PNG, BMP, GIF

2. **شروع تشخیص:**

   - روی دکمه **"شروع تشخیص"** کلیک کنید
   - منتظر بمانید تا فرآیند تشخیص کامل شود (معمولاً چند ثانیه)

3. **مشاهده نتایج:**
   - تصویر با Bounding Box‌های سبز رنگ نمایش داده می‌شود
   - در پنل سمت راست، لیست تمام پلاک‌های تشخیص داده شده را مشاهده خواهید کرد
   - برای هر پلاک، اطلاعات زیر نمایش داده می‌شود:
     - شماره پلاک
     - درصد اعتماد (Confidence)
     - مختصات Bounding Box
     - نوع خودرو
     - زمان تشخیص

## اطلاعات فنی

### وابستگی‌ها

این قابلیت از پکیج‌های زیر استفاده می‌کند:

- `Microsoft.ML.OnnxRuntime` (v1.17.0): برای اجرای مدل YOLO
- `OpenCvSharp4` (v4.9.0): برای پردازش تصویر
- `OpenCvSharp4.Extensions`: برای تبدیل تصاویر به Bitmap

### کلاس‌های اصلی

1. **`TestDetectionForm`**: فرم اصلی تست تشخیص

   - مسئول رابط کاربری
   - نمایش تصاویر و نتایج

2. **`PlateDetectionTestService`**: سرویس تشخیص پلاک
   - بارگذاری مدل YOLO
   - پیش‌پردازش تصویر
   - اجرای تشخیص
   - پس‌پردازش نتایج و رسم Bounding Box

### فرآیند تشخیص

1. **پیش‌پردازش:**

   - تغییر اندازه تصویر به 640x640 پیکسل
   - تبدیل از BGR به RGB
   - نرمال‌سازی مقادیر پیکسل‌ها (0-1)

2. **تشخیص:**

   - اجرای مدل YOLO با استفاده از ONNX Runtime
   - دریافت خروجی مدل

3. **پس‌پردازش:**

   - تبدیل مختصات نسبی به مطلق
   - فیلتر کردن بر اساس آستانه اعتماد
   - استخراج شماره پلاک (در نسخه فعلی: تصادفی)

4. **نمایش:**
   - رسم Bounding Box‌ها روی تصویر
   - نمایش اطلاعات تشخیص

## نکات مهم

- **آستانه اعتماد:** اگر پلاکی تشخیص داده نمی‌شود، سعی کنید آستانه اعتماد را کاهش دهید (مثلاً از 0.5 به 0.3)

- **کیفیت تصویر:** تصاویر با کیفیت بهتر و روشنایی مناسب، نتایج بهتری دارند

- **مدل YOLO:** مطمئن شوید از یک مدل YOLO آموزش دیده برای تشخیص پلاک ایرانی استفاده می‌کنید

- **OCR:** در نسخه فعلی، شماره پلاک به صورت تصادفی تولید می‌شود. برای استخراج واقعی شماره پلاک، باید یک مدل OCR اضافه شود

## عیب‌یابی

### مدل بارگذاری نمی‌شود

- مسیر فایل مدل را بررسی کنید
- مطمئن شوید فایل `.onnx` معتبر است
- فایل نباید خراب یا ناقص باشد

### هیچ پلاکی تشخیص داده نمی‌شود

- آستانه اعتماد را کاهش دهید
- تصویر را بررسی کنید (روشنایی، وضوح، زاویه)
- مطمئن شوید مدل YOLO برای پلاک ایرانی آموزش دیده است

### خطای حافظه (Out of Memory)

- تصاویر با حجم کمتر استفاده کنید
- برنامه را ببندید و دوباره باز کنید

## توسعه‌های آینده

- [ ] اضافه کردن OCR واقعی برای استخراج شماره پلاک
- [ ] پشتیبانی از تشخیص چند پلاک همزمان
- [ ] ذخیره نتایج تست
- [ ] مقایسه نتایج با Ground Truth
- [ ] نمایش متریک‌های عملکرد (Precision, Recall, F1-Score)
- [ ] پشتیبانی از ویدیو برای تست

## مجوز

این نرم‌افزار تحت مجوز پروژه اصلی `Ntk.NumberPlate.Hub` منتشر شده است.
